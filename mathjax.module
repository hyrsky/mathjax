<?php
/**
 * @file
 * MathJax module.
 */

/**
 * Implements hook_help().
 */
function mathjax_help($path, $arg) {
  switch ($path) {
    // Main module help for the mathjax module.
    case 'admin/config/content/mathjax':
      return t('MathJax allows you to include mathematics in your web pages, either using TeX and LaTeX notation, or as MathML, and you can even use both in the same document. Go to the <a href="@url">MathJax website</a> for more information.', array('@url' => url('http://www.mathjax.org/')));

    case 'admin/help#mathjax':
      return '<p>' . t('MathJax allows you to include mathematics in your web pages, either using TeX and LaTeX notation, or as MathML, and you can even use both in the same document. Go to the <a href="@url">MathJax website</a> for more information.', array('@url' => url('http://www.mathjax.org/'))) . '</p>';
  }
}

/**
 * Implements hook_page_attachments().
 */
function mathjax_page_attachments(&$page) {
  $config = Drupal::config('mathjax.settings');
  if ($config->get('config_type') == 0) {
    $config_string = $config->get('default_config_string');
  }
  else {
    $config_string = $config->get('config_string');
  }

  // Load Mathjax.
  $page['#attached']['js'][] = array(
    'type' => 'inline',
    'data' => $config_string,
    'every_page' => TRUE,
    'weight' => -10,
  );
  $page['#attached']['library'][] = 'mathjax/mathjax';
  $settings = ['mathjax' =>
    ['config_type' => $config->get('config_type')]
  ];
  $page['#attached']['js'][] = array('data' => $settings, 'type' => 'setting');

  if ($config->get('use_cdn', TRUE)) {
    $cdn_url = $config->get('cdn_url');
    $page['#attached']['js'][$cdn_url] = array('every_page' => TRUE, 'type' => 'external');
  }
  else {
    if (function_exists('libraries_get_path')) {
      $page['#attached']['js'][libraries_get_path('mathjax', TRUE) . '/MathJax.js?config=TeX-AMS-MML_HTMLorMML'] = array('every_page' => TRUE, 'type' => 'external');
    }
  }
}
